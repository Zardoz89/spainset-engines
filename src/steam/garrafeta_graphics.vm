#*
 *  Copyright (C) 2021 The Spanish Trainset
 *  Based on The Dutch Trainset 2 files and NewGRF build framework
 *  This file is part of The Spanish Transet
 *  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
 *  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 *#
// *** ${id} ***
// AUTOGENERATED - DON'T EDIT THE OUTPUT PNML FILE

#set($animationFramesMinusOne = $animationFrames - 1)

#parse("src/lib_graphics.vm")

// Purchase
#pucharseSprite("steam", $id, $imageFile)

// Engine animation
#animatedSpriteSets("steam", $id, $imageFile, $length, $animationFrames)

#if ($tenderLength > 0)
// Tender
spriteset(spriteset_steam_${id}_tender, "gfx/${imageFile}.png") {
  template_s${tenderLength}(1, 192)
}
#end

// Animation states of the engine
switch(FEAT_TRAINS, SELF, switch_steam_${id}_animation, motion_counter % ${animationFrames}){
#foreach ($frame in [0..$animationFramesMinusOne])
  ${frame}: spriteset_steam_${id}_ani_${frame};##
#end

  spriteset_steam_${id}_ani_${animationFramesMinusOne};
}

//= Callbacks

#if ($tenderLength > 0)
// Chain the tender
switch(FEAT_TRAINS, SELF, switch_steam_${id}_position, (position_in_vehid_chain % 2)) {
  1: spriteset_steam_${id}_tender;
  switch_steam_${id}_animation;
}

// Sets the articulation
switch(FEAT_TRAINS, SELF, switch_steam_${id}_articulated, extra_callback_info1) {
  1: return item_steam_${id};
  return CB_RESULT_NO_MORE_ARTICULATED_PARTS;
}

#if ($length > 8)
  #set($length = 8)
#end
// Sets the length of each articulation
switch(FEAT_TRAINS, SELF, switch_steam_${id}_length, position_in_vehid_chain % 2) {
  0: ${length};
  ## Engine length
  ${tenderLength};
  ## Tender length
}

// Visual effect of smoke
switch(FEAT_TRAINS, SELF, switch_steam_${id}_visual_effect_and_powered, (position_in_vehid_chain % 2)) {
  1: return visual_effect_and_powered(VISUAL_EFFECT_DISABLE, 0, DISABLE_WAGON_POWER);
  return visual_effect_and_powered(VISUAL_EFFECT_STEAM, ${effect}, DISABLE_WAGON_POWER);
}
#end
